{"version":3,"file":"index.cjs.js","sources":["../../dist/commands/similar/src/index.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { createCommand, ensureAbsolute, parseGlobalArgs, } from '@graphql-inspector/commands';\nimport { Logger, figures, chalk } from '@graphql-inspector/logger';\nimport { similar as findSimilar, getTypePrefix, } from '@graphql-inspector/core';\nimport { extname } from 'path';\nimport { writeFileSync } from 'fs';\nexport function handler({ schema, writePath, type, threshold, }) {\n    const shouldWrite = typeof writePath !== 'undefined';\n    const similarMap = findSimilar(schema, type, threshold);\n    if (!Object.keys(similarMap).length) {\n        Logger.info('No similar types found');\n    }\n    else {\n        for (const typeName in similarMap) {\n            if (similarMap.hasOwnProperty(typeName)) {\n                const matches = similarMap[typeName];\n                const prefix = getTypePrefix(schema.getType(typeName));\n                const sourceType = chalk.bold(typeName);\n                const name = matches.bestMatch.target.typeId;\n                Logger.log('');\n                Logger.log(`${prefix} ${sourceType}`);\n                Logger.log(printResult(name, matches.bestMatch.rating));\n                matches.ratings.forEach((match) => {\n                    Logger.log(printResult(match.target.typeId, match.rating));\n                });\n            }\n        }\n        if (shouldWrite) {\n            if (typeof writePath !== 'string') {\n                throw new Error(`--write is not valid file path: ${writePath}`);\n            }\n            const absPath = ensureAbsolute(writePath);\n            const ext = extname(absPath).replace('.', '').toLocaleLowerCase();\n            let output = undefined;\n            const results = transformMap(similarMap);\n            if (ext === 'json') {\n                output = outputJSON(results);\n            }\n            if (output) {\n                writeFileSync(absPath, output, {\n                    encoding: 'utf-8',\n                });\n                Logger.success(`Available at ${absPath}\\n`);\n            }\n            else {\n                throw new Error(`Extension ${ext} is not supported`);\n            }\n        }\n    }\n}\nexport default createCommand((api) => {\n    const { loaders } = api;\n    return {\n        command: 'similar <schema>',\n        describe: 'Find similar types in a schema',\n        builder(yargs) {\n            return yargs\n                .positional('schema', {\n                describe: 'Point to a schema',\n                type: 'string',\n                demandOption: true,\n            })\n                .options({\n                n: {\n                    alias: 'name',\n                    describe: 'Name of a type',\n                    type: 'string',\n                },\n                t: {\n                    alias: 'threshold',\n                    describe: 'Threshold of similarity ratio',\n                    type: 'number',\n                },\n                w: {\n                    alias: 'write',\n                    describe: 'Write a file with stats',\n                    type: 'string',\n                },\n            });\n        },\n        handler(args) {\n            return __awaiter(this, void 0, void 0, function* () {\n                const { headers, token } = parseGlobalArgs(args);\n                const writePath = args.write;\n                const type = args.name;\n                const threshold = args.threshold;\n                const schema = yield loaders.loadSchema(args.schema, {\n                    headers,\n                    token,\n                });\n                return handler({ schema, writePath, type, threshold });\n            });\n        },\n    };\n});\nfunction indent(line, space) {\n    return line.padStart(line.length + space, ' ');\n}\nfunction transformMap(similarMap) {\n    const results = {};\n    for (const typename in similarMap) {\n        if (similarMap.hasOwnProperty(typename)) {\n            const result = similarMap[typename];\n            results[typename] = [];\n            if (result.bestMatch) {\n                results[typename].push(trasformResult(result.bestMatch));\n            }\n            if (result.ratings) {\n                results[typename].push(...result.ratings.map(trasformResult));\n            }\n        }\n    }\n    return results;\n}\nfunction trasformResult(record) {\n    return {\n        typename: record.target.typeId,\n        rating: record.rating,\n    };\n}\nfunction outputJSON(results) {\n    return JSON.stringify(results);\n}\nfunction printResult(name, rating) {\n    const percentage = chalk.grey(`(${formatRating(rating)}%)`);\n    return indent(`${printScale(rating)} ${percentage} ${name}`, 0);\n}\nfunction printScale(ratio) {\n    const percentage = Math.floor(ratio * 100);\n    const levels = [0, 30, 50, 70, 90];\n    return levels\n        .map((level) => percentage >= level)\n        .map((enabled) => (enabled ? figures.bullet : chalk.gray(figures.bullet)))\n        .join('');\n}\nfunction formatRating(ratio) {\n    return Math.floor(ratio * 100);\n}\n//# sourceMappingURL=index.js.map"],"names":["findSimilar","Logger","getTypePrefix","chalk","ensureAbsolute","extname","writeFileSync","createCommand","__awaiter","parseGlobalArgs","figures"],"mappings":"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"}